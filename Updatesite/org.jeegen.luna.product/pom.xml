<?xml version="1.0" encoding="UTF-8"?>
<project>
	<modelVersion>4.0.0</modelVersion>

	<parent>
		<groupId>org.jeegen</groupId>
		<artifactId>releng</artifactId>
		<version>1.0.0-SNAPSHOT</version>
		<relativePath>../org.jeegen.releng/pom.xml</relativePath>
	</parent>

	<name>JEE DSL Product</name>
	<version>1.1.9-SNAPSHOT</version>
	<groupId>org.jeegen</groupId>
	<artifactId>jee.product.luna</artifactId>

	<properties>
		<download.server>ftp.halifax.rwth-aachen.de</download.server>
		<download.eclipse.url>http://${download.server}/eclipse/technology/epp/downloads/release/luna/SR2/</download.eclipse.url>
		<download.director.path>eclipse/tools/buckminster/products</download.director.path>

		<eclipse.download>download</eclipse.download>
		<eclipse.package>jee</eclipse.package>
		<eclipse.version>luna-SR2</eclipse.version>
		<appname>jee-generator</appname>

		<eclipsesdk.osx32>${download.eclipse.url}${eclipsesdk.osx32.filename}.tar.gz</eclipsesdk.osx32>
		<eclipsesdk.osx32.filename>eclipse-${eclipse.package}-${eclipse.version}-macosx-cocoa</eclipsesdk.osx32.filename>

		<eclipsesdk.osx>${download.eclipse.url}${eclipsesdk.osx.filename}.tar.gz</eclipsesdk.osx>
		<eclipsesdk.osx.filename>eclipse-${eclipse.package}-${eclipse.version}-macosx-cocoa-x86_64</eclipsesdk.osx.filename>

		<eclipsesdk.windows32>${download.eclipse.url}${eclipsesdk.windows32.filename}.zip</eclipsesdk.windows32>
		<eclipsesdk.windows32.filename>eclipse-${eclipse.package}-${eclipse.version}-win32</eclipsesdk.windows32.filename>

		<eclipsesdk.windows>${download.eclipse.url}${eclipsesdk.windows.filename}.zip</eclipsesdk.windows>
		<eclipsesdk.windows.filename>eclipse-${eclipse.package}-${eclipse.version}-win32-x86_64</eclipsesdk.windows.filename>

		<eclipsesdk.linux32>${download.eclipse.url}${eclipsesdk.linux32.filename}.tar.gz</eclipsesdk.linux32>
		<eclipsesdk.linux32.filename>eclipse-${eclipse.package}-${eclipse.version}-linux-gtk</eclipsesdk.linux32.filename>

		<eclipsesdk.linux>${download.eclipse.url}${eclipsesdk.linux.filename}.tar.gz</eclipsesdk.linux>
		<eclipsesdk.linux.filename>eclipse-${eclipse.package}-${eclipse.version}-linux-gtk-x86_64</eclipsesdk.linux.filename>
	</properties>

	<build>
		<plugins>
			<plugin>
				<artifactId>maven-antrun-plugin</artifactId>
				<version>${antrun-version}</version>
				<executions>
					<execution>
						<id>default-cli</id>
						<phase>initialize</phase>
						<goals>
							<goal>run</goal>
						</goals>
						<configuration>
							<target name="builder">
								<taskdef name="builder"
									classname="at.bestsolution.releng.distrobuilder.ant.DistroBuilderTaskDef" />
								<mkdir dir="builder" />
								<mkdir dir="repos/shared" />

								<!-- LUNA JEE -->
								<mkdir dir="${eclipse.download}/${eclipse.version}/macosx/x86" />
								<mkdir dir="${eclipse.download}/${eclipse.version}/macosx/x86_64" />
								<mkdir dir="${eclipse.download}/${eclipse.version}/win32/x86_64" />
								<mkdir dir="${eclipse.download}/${eclipse.version}/win32/x86" />
								<mkdir dir="${eclipse.download}/${eclipse.version}/linux/x86" />
								<mkdir dir="${eclipse.download}/${eclipse.version}/linux/x86_64" />

								<get
									src="http://${download.server}/${download.director.path}/director_latest.zip"
									dest="${project.build.directory}/director_latest.zip"
									skipexisting="true" />

								<unzip src="${project.build.directory}/director_latest.zip"
									dest="${project.build.directory}" />
								<chmod file="${project.build.directory}/director/director"
									perm="+x" />

								<!-- FETCH BASE DISTROS -->
								<!-- OSX -->
								<get src="${eclipsesdk.osx32}"
									dest="${eclipse.download}/${eclipse.version}/macosx/x86/eclipse-${eclipse.package}-${eclipse.version}-macosx-cocoa.tar.gz"
									skipexisting="true" />
								<get src="${eclipsesdk.osx}"
									dest="${eclipse.download}/${eclipse.version}/macosx/x86_64/eclipse-${eclipse.package}-${eclipse.version}-macosx-cocoa-x86_64.tar.gz"
									skipexisting="true" />

								<!-- Windows -->
								<get src="${eclipsesdk.windows32}"
									dest="${eclipse.download}/${eclipse.version}/win32/x86/eclipse-${eclipse.package}-${eclipse.version}-win32.zip"
									skipexisting="true" />
								<get src="${eclipsesdk.windows}"
									dest="${eclipse.download}/${eclipse.version}/win32/x86_64/eclipse-${eclipse.package}-${eclipse.version}-win32-x86_64.zip"
									skipexisting="true" />

								<!-- Linux -->
								<get src="${eclipsesdk.linux32}"
									dest="${eclipse.download}/${eclipse.version}/linux/x86/eclipse-${eclipse.package}-${eclipse.version}-linux-gtk.tar.gz"
									skipexisting="true" />
								<get src="${eclipsesdk.linux}"
									dest="${eclipse.download}/${eclipse.version}/linux/x86_64/eclipse-${eclipse.package}-${eclipse.version}-linux-gtk-x86_64.tar.gz"
									skipexisting="true" />



								<echo>Build Distribution</echo>
								<builder builddirectory="${project.build.directory}/build"
										p2directorexecutable="${project.build.directory}/director/director"
										targetdirectory="${basedir}/${eclipse.download}"
										staticreposdirectory="${basedir}/repos"
										distdirectory="${project.build.directory}/dist"
										appname="${appname}"
										version="${project.version}">

									<updatesite url="http://download.eclipse.org/releases/luna/" />
									<updatesite url="http://download.itemis.com/updates/releases/" />
									<updatesite url="http://www.jee-generator.org/updates/snapshot/luna/" />

									<!-- Eclipse git -->
									<installunit name="org.eclipse.egit.feature.group" />

									<!-- Xtext, MWE2 -->
									<installunit name="org.eclipse.emf.sdk.feature.group" />
									<installunit name="org.eclipse.emf.mwe.sdk.feature.group" />
									<installunit name="org.eclipse.emf.mwe2.language.sdk.feature.group" />
									<installunit name="org.eclipse.emf.mwe2.runtime.sdk.feature.group" />
									<installunit name="org.eclipse.xtext.sdk.feature.group" />
									<installunit name="org.eclipse.xtext.xtend2.sdk.feature.group" />
									<installunit name="org.eclipse.xtext.xtend2.m2e.feature.group" />

									<!-- Java EE Generators -->
									<installunit name="org.jeegen.jee6.feature.feature.group" />
									<installunit name="org.jeegen.jee7.feature.feature.group" />
								</builder>

								<!-- Linux -->
								<move file="${project.build.directory}/dist/${eclipsesdk.linux32.filename}-${appname}-${project.version}.tar.gz"
										tofile="${project.build.directory}/dist/eclipse-jee-generator-${eclipse.version}-linux-gtk.tar.gz" />
								<move file="${project.build.directory}/dist/${eclipsesdk.linux.filename}-${appname}-${project.version}.tar.gz"
										tofile="${project.build.directory}/dist/eclipse-jee-generator-${eclipse.version}-linux-gtk-x86_64.tar.gz" />

								<!-- Windows -->
								<move file="${project.build.directory}/dist/${eclipsesdk.windows32.filename}-${appname}-${project.version}.zip"
										tofile="${project.build.directory}/dist/eclipse-jee-generator-${eclipse.version}-win32.zip" />
								<move file="${project.build.directory}/dist/${eclipsesdk.windows.filename}-${appname}-${project.version}.zip"
										tofile="${project.build.directory}/dist/eclipse-jee-generator-${eclipse.version}-win32-x86_64.zip" />

								<!-- OSX -->
								<move file="${project.build.directory}/dist/${eclipsesdk.osx32.filename}-${appname}-${project.version}.tar.gz"
										tofile="${project.build.directory}/dist/eclipse-jee-generator-${eclipse.version}-macosx-cocoa.tar.gz" />
								<move file="${project.build.directory}/dist/${eclipsesdk.osx.filename}-${appname}-${project.version}.tar.gz"
										tofile="${project.build.directory}/dist/eclipse-jee-generator-${eclipse.version}-macosx-cocoa-x86_64.tar.gz" />
							</target>
						</configuration>
					</execution>
				</executions>
				<dependencies>
					<dependency>
						<groupId>at.bestsolution.releng.distrobuilder</groupId>
						<artifactId>at.bestsolution.releng.distrobuilder</artifactId>
						<version>0.0.1-SNAPSHOT</version>
					</dependency>
				</dependencies>
			</plugin>
		</plugins>
	</build>

	<dependencies>
		<dependency>
			<groupId>ant</groupId>
			<artifactId>ant-optional</artifactId>
			<version>1.5.2</version>
		</dependency>
		<!-- <dependency> <groupId>commons-net</groupId> <artifactId>commons-net</artifactId> 
			<version>3.2</version> </dependency> -->
	</dependencies>

	<pluginRepositories>
		<!-- Distrobuilder -->
		<pluginRepository>
			<id>cloudbees.kthoms.snapshot</id>
			<url>https://repository-kthoms.forge.cloudbees.com/snapshot/</url>
			<snapshots>
				<enabled>true</enabled>
			</snapshots>
		</pluginRepository>
	</pluginRepositories>
</project>
