<?xml version="1.0" encoding="UTF-8"?>
<project>
	<modelVersion>4.0.0</modelVersion>

	<parent>
		<groupId>org.jeegen</groupId>
		<artifactId>releng</artifactId>
		<version>1.0.0-SNAPSHOT</version>
		<relativePath>../org.jeegen.releng/pom.xml</relativePath>
	</parent>

	<name>JEE DSL Product</name>
	<version>1.1.9-SNAPSHOT</version>
	<groupId>org.jeegen</groupId>
	<artifactId>jee.product.kepler</artifactId>

	<properties>
		<appname>jee-generator</appname>

		<eclipse.download>download</eclipse.download>
		<eclipse.package>jee</eclipse.package>
		<eclipse.distro>kepler</eclipse.distro>
		<eclipse.release>SR2</eclipse.release>
		<eclipse.version>${eclipse.distro}-${eclipse.release}</eclipse.version>

		<download.server>ftp.halifax.rwth-aachen.de</download.server>
		<download.eclipse.url>http://${download.server}/eclipse/technology/epp/downloads/release/${eclipse.distro}/${eclipse.release}/</download.eclipse.url>
		<download.director.path>eclipse/tools/buckminster/products</download.director.path>

		<eclipse.linux64>${download.eclipse.url}${eclipse.linux64.filename}.tar.gz</eclipse.linux64>
		<eclipse.linux64.filename>eclipse-${eclipse.package}-${eclipse.version}-linux-gtk-x86_64</eclipse.linux64.filename>

		<eclipse.linux32>${download.eclipse.url}${eclipse.linux32.filename}.tar.gz</eclipse.linux32>
		<eclipse.linux32.filename>eclipse-${eclipse.package}-${eclipse.version}-linux-gtk</eclipse.linux32.filename>

		<eclipse.osx64>${download.eclipse.url}${eclipse.osx64.filename}.tar.gz</eclipse.osx64>
		<eclipse.osx64.filename>eclipse-${eclipse.package}-${eclipse.version}-macosx-cocoa-x86_64</eclipse.osx64.filename>

		<eclipse.windows64>${download.eclipse.url}${eclipse.windows64.filename}.zip</eclipse.windows64>
		<eclipse.windows64.filename>eclipse-${eclipse.package}-${eclipse.version}-win32-x86_64</eclipse.windows64.filename>

		<eclipse.windows32>${download.eclipse.url}${eclipse.windows32.filename}.zip</eclipse.windows32>
		<eclipse.windows32.filename>eclipse-${eclipse.package}-${eclipse.version}-win32</eclipse.windows32.filename>
	</properties>

	<build>
		<plugins>
			<plugin>
				<artifactId>maven-antrun-plugin</artifactId>
				<version>1.7</version>
				<executions>
					<execution>
						<id>default-cli</id>
						<phase>initialize</phase>
						<goals>
							<goal>run</goal>
						</goals>
						<configuration>
							<target name="builder">
								<taskdef name="builder"
									classname="at.bestsolution.releng.distrobuilder.ant.DistroBuilderTaskDef" />
								<mkdir dir="builder" />
								<mkdir dir="repos/shared" />

								<!-- KEPLER JEE -->
								<mkdir dir="${eclipse.download}/${eclipse.version}/linux/x86_64" />
								<mkdir dir="${eclipse.download}/${eclipse.version}/linux/x86" />
								<mkdir dir="${eclipse.download}/${eclipse.version}/macosx/x86_64" />
								<mkdir dir="${eclipse.download}/${eclipse.version}/macosx/x86" />
								<mkdir dir="${eclipse.download}/${eclipse.version}/win32/x86_64" />
								<mkdir dir="${eclipse.download}/${eclipse.version}/win32/x86" />

								<get
									src="http://${download.server}/${download.director.path}/director_latest.zip"
									dest="${project.build.directory}/director_latest.zip"
									skipexisting="true" />

								<unzip src="${project.build.directory}/director_latest.zip"
									dest="${project.build.directory}" />
								<chmod file="${project.build.directory}/director/director"
									perm="+x" />

								<!-- FETCH BASE DISTROS -->
								<get src="${eclipse.linux64}"
									dest="${eclipse.download}/${eclipse.version}/linux/x86_64/eclipse-${eclipse.package}-${eclipse.version}-linux-gtk-x86_64.tar.gz"
									skipexisting="true" />
								<get src="${eclipse.linux32}"
									dest="${eclipse.download}/${eclipse.version}/linux/x86/eclipse-${eclipse.package}-${eclipse.version}-linux-gtk.tar.gz"
									skipexisting="true" />
								<get src="${eclipse.osx64}"
									dest="${eclipse.download}/${eclipse.version}/macosx/x86_64/eclipse-${eclipse.package}-${eclipse.version}-macosx-cocoa-x86_64.tar.gz"
									skipexisting="true" />
								<get src="${eclipse.windows64}"
									dest="${eclipse.download}/${eclipse.version}/win32/x86_64/eclipse-${eclipse.package}-${eclipse.version}-win32-x86_64.zip"
									skipexisting="true" />
								<get src="${eclipse.windows32}"
									dest="${eclipse.download}/${eclipse.version}/win32/x86/eclipse-${eclipse.package}-${eclipse.version}-win32.zip"
									skipexisting="true" />

								<echo>Build Distribution</echo>
								<builder builddirectory="${project.build.directory}/build"
										p2directorexecutable="${project.build.directory}/director/director"
										targetdirectory="${basedir}/${eclipse.download}"
										staticreposdirectory="${basedir}/repos"
										distdirectory="${project.build.directory}/dist"
										appname="${appname}"
										version="${project.version}">

									<updatesite url="http://download.eclipse.org/releases/${eclipse.distro}/" />
									<updatesite url="http://download.itemis.com/updates/releases/" />
									<updatesite url="http://www.jee-generator.org/updates/release/" />

									<!-- Eclipse staff -->
									<installunit name="org.eclipse.egit.feature.group" />
									<installunit name="org.eclipse.sdk.ide" />

									<!-- Java EE Generators -->
									<installunit name="org.jeegen.jee6.feature.feature.group" />
									<installunit name="org.jeegen.jee7.feature.feature.group" />
								</builder>

								<!-- Renaming files -->
								<move file="${project.build.directory}/dist/${eclipse.linux64.filename}-${appname}-${project.version}.tar.gz"
										tofile="${project.build.directory}/dist/eclipse-${appname}-${eclipse.version}-linux-gtk-x86_64.tar.gz" />
								<move file="${project.build.directory}/dist/${eclipse.linux32.filename}-${appname}-${project.version}.tar.gz"
										tofile="${project.build.directory}/dist/eclipse-${appname}-${eclipse.version}-linux-gtk.tar.gz" />
								<move file="${project.build.directory}/dist/${eclipse.osx64.filename}-${appname}-${project.version}.tar.gz"
										tofile="${project.build.directory}/dist/eclipse-${appname}-${eclipse.version}-macosx-cocoa-x86_64.tar.gz" />
								<move file="${project.build.directory}/dist/${eclipse.windows64.filename}-${appname}-${project.version}.zip"
										tofile="${project.build.directory}/dist/eclipse-${appname}-${eclipse.version}-win32-x86_64.zip" />
								<move file="${project.build.directory}/dist/${eclipse.windows32.filename}-${appname}-${project.version}.zip"
										tofile="${project.build.directory}/dist/eclipse-${appname}-${eclipse.version}-win32.zip" />
							</target>
						</configuration>
					</execution>
				</executions>
				<dependencies>
					<dependency>
						<groupId>at.bestsolution.releng.distrobuilder</groupId>
						<artifactId>at.bestsolution.releng.distrobuilder</artifactId>
						<version>0.0.1-SNAPSHOT</version>
					</dependency>
				</dependencies>
			</plugin>
		</plugins>
	</build>

	<dependencies>
		<dependency>
			<groupId>ant</groupId>
			<artifactId>ant-optional</artifactId>
			<version>1.5.2</version>
		</dependency>
	</dependencies>

	<pluginRepositories>
		<!-- Distrobuilder -->
		<pluginRepository>
			<id>cloudbees.kthoms.snapshot</id>
			<url>https://repository-kthoms.forge.cloudbees.com/snapshot/</url>
			<snapshots>
				<enabled>true</enabled>
			</snapshots>
		</pluginRepository>
	</pluginRepositories>
</project>
